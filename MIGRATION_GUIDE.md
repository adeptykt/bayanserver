# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

–§–∞–π–ª `authentication.js` (1939 —Å—Ç—Ä–æ–∫) –±—ã–ª —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ **9 –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –º–æ–¥—É–ª–µ–π**:

| –§–∞–π–ª | –°—Ç—Ä–æ–∫ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-------|------------|
| `src/authentication.js` | 106 | –¢–æ–ª—å–∫–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ |
| `src/routes/partner.js` | ~650 | –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ API |
| `src/routes/stats.js` | ~250 | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| `src/routes/utils.js` | ~400 | –£—Ç–∏–ª–∏—Ç—ã –∏ –º–∏–≥—Ä–∞—Ü–∏–∏ |
| `src/routes/webhooks.js` | ~120 | Webhook'–∏ –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π |
| `src/services/bonus.service.js` | ~250 | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –±–æ–Ω—É—Å–æ–≤ |
| `src/utils/date-helpers.js` | ~100 | –§—É–Ω–∫—Ü–∏–∏ –¥–∞—Ç |
| `src/utils/string-helpers.js` | ~10 | –§—É–Ω–∫—Ü–∏–∏ —Å—Ç—Ä–æ–∫ |
| `src/jobs/cron-tasks.js` | ~50 | –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á |

**–£–ª—É—á—à–µ–Ω–∏–µ:** –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ —É–º–µ–Ω—å—à–µ–Ω —Å 1939 –¥–æ ~215 —Å—Ç—Ä–æ–∫ (-89%)

---

## üìã –®–∞–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –Ω–æ–≤—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –∏ —Ñ–∞–π–ª–æ–≤
ls -la src/routes/
ls -la src/jobs/
ls -la src/utils/date-helpers.js
ls -la src/utils/string-helpers.js
ls -la src/services/bonus.service.js
```

### –®–∞–≥ 2: –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª
cp src/authentication.js src/authentication.js.old
```

### –®–∞–≥ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
npm start
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

#### 4.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏:

**JWT:**
```bash
curl -X POST http://localhost:3030/authentication \
  -H "Content-Type: application/json" \
  -d '{"strategy":"local","phone":"9241234567","password":"123456"}'
```

**SMS:**
```bash
# 1. –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –∫–æ–¥
curl -X POST http://localhost:3030/codes \
  -H "Content-Type: application/json" \
  -d '{"phone":"9241234567"}'

# 2. –í–æ–π–¥–∏—Ç–µ —Å –∫–æ–¥–æ–º
curl -X POST http://localhost:3030/authentication \
  -H "Content-Type: application/json" \
  -d '{"strategy":"mobile","phone":"9241234567","code":"123456"}'
```

#### 4.2 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–≥–æ API:

```bash
curl -X GET http://localhost:3030/v1/partner/company \
  -H "x-api-key: RW9uRHkzSGxhV3pZT10xaE1fbHBEJnFSMElsM0hwOmN2VnZiZTopVl5bQDg3Jj14Kms="
```

#### 4.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:

```bash
curl -X GET http://localhost:3030/bonuses
```

#### 4.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ webhook'–æ–≤:

```bash
curl -X GET "http://localhost:3030/v1/findcert?number=12345"
```

#### 4.5 –ü—Ä–æ–≤–µ—Ä–∫–∞ cron-–∑–∞–¥–∞—á:

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∫–æ–Ω—Å–æ–ª–∏ –µ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
Cron tasks initialized
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### 1. –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª:

```bash
cp env.example .env
```

### 2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env:

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
MONGO_URI=mongodb://admin:Zdf1740@localhost:27017/fserver
JWT_SECRET=a17544f8ac0f3bba4fe7b73ea55ff...  # –≤–∞—à —Å–µ–∫—Ä–µ—Ç
PARTNER_API_KEY=RW9uRHkzSGxhV3pZT10xaE1fbHBEJnFSMElsM0hwOmN2VnZiZTopVl5bQDg3Jj14Kms=

# SMS
SMS_API_KEY=7DDDC5B0-EBDB-8EDB-5562-D8AB4759BE2E

# Email
EMAIL_PASSWORD=ftNFK3JZnfuk03kJ9tSZ

# –ü–ª–∞—Ç–µ–∂–∏
SBERBANK_TOKEN=v2jhlaepchtugujk2jv4ikd72d
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ dotenv:

```bash
npm install dotenv
```

### 4. –û–±–Ω–æ–≤–∏—Ç–µ config/default.json:

```javascript
// –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
{
  "mongodb": process.env.MONGO_URI,
  "authentication": {
    "secret": process.env.JWT_SECRET,
    // ...
  }
}
```

---

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ú–æ–¥—É–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω

**–û—à–∏–±–∫–∞:**
```
Error: Cannot find module './routes/partner'
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ–∑–¥–∞–Ω—ã
mkdir -p src/routes
mkdir -p src/jobs
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: BonusService is not a constructor

**–û—à–∏–±–∫–∞:**
```
TypeError: BonusService is not a constructor
```

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ —Ñ–∞–π–ª–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π export:
```javascript
// src/services/bonus.service.js
module.exports = BonusService;  // ‚Üê –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–ª–∞—Å—Å
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Ä–æ—É—Ç—ã –ø–æ–¥–∫–ª—é—á–µ–Ω—ã –≤ `app.js`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MongoDB –∑–∞–ø—É—â–µ–Ω–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 4: Cron –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ, –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
Cron tasks initialized
```

–ï—Å–ª–∏ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `src/jobs/cron-tasks.js`

---

## üìä –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ß–µ–∫-–ª–∏—Å—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏:

- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è JWT —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è SMS —Ä–∞–±–æ—Ç–∞–µ—Ç  
- [ ] –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ API –æ—Ç–≤–µ—á–∞—é—Ç
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
- [ ] Webhook'–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
- [ ] Cron-–∑–∞–¥–∞—á–∏ –∑–∞–ø—É—â–µ–Ω—ã
- [ ] –ë–æ–Ω—É—Å—ã –Ω–∞—á–∏—Å–ª—è—é—Ç—Å—è
- [ ] –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è
- [ ] Email –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- [ ] SMS –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è

---

## üîÑ –û—Ç–∫–∞—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π (–µ—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é

```bash
# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª
cp src/authentication.js.old src/authentication.js

# –û—Ç–∫–∞—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ app.js
git checkout src/app.js
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å git

```bash
# –û—Ç–∫–∞—Ç–∏—Ç–µ –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git checkout .
```

---

## üí° –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

### 1. –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
npm install winston
```

```javascript
// src/utils/logger.js
const winston = require('winston');

const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});

module.exports = logger;
```

### 2. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã

```bash
npm install --save-dev mocha chai supertest
```

```javascript
// test/routes/partner.test.js
const request = require('supertest');
const app = require('../src/app');

describe('Partner API', () => {
  it('should return company settings', (done) => {
    request(app)
      .get('/v1/partner/company')
      .set('x-api-key', 'RW9u...')
      .expect(200)
      .end(done);
  });
});
```

### 3. –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API

```bash
npm install swagger-ui-express swagger-jsdoc
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `npm start` –∏ –∏–∑—É—á–∏—Ç–µ –≤—ã–≤–æ–¥
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ MongoDB: `mongod --version`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é Node.js: `node --version`
4. –ò–∑—É—á–∏—Ç–µ —Ñ–∞–π–ª `REFACTORING.md` –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

---

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:

‚úÖ **–ß–∏—Å—Ç—ã–π –∫–æ–¥** - –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª < 700 —Å—Ç—Ä–æ–∫  
‚úÖ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏  
‚úÖ **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –ø–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏  
‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –±–∞–≥–∏  
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã  

**–£—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏! üéâ**

