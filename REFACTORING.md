# üîß –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É authentication.js

## üìã –û–±–∑–æ—Ä

–û–≥—Ä–æ–º–Ω—ã–π —Ñ–∞–π–ª `authentication.js` (1939 —Å—Ç—Ä–æ–∫) –±—ã–ª —Ä–∞–∑–¥–µ–ª–µ–Ω –Ω–∞ –ª–æ–≥–∏—á–µ—Å–∫–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –º–æ–¥—É–ª–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞.

---

## üóÇÔ∏è –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

### –î–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
```
src/
  ‚îú‚îÄ‚îÄ authentication.js (1939 —Å—Ç—Ä–æ–∫)
  ‚îî‚îÄ‚îÄ ...
```

### –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:
```
src/
  ‚îú‚îÄ‚îÄ authentication.js (106 —Å—Ç—Ä–æ–∫) ‚Üê —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
  ‚îú‚îÄ‚îÄ routes/
  ‚îÇ   ‚îú‚îÄ‚îÄ partner.js      ‚Üê –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
  ‚îÇ   ‚îú‚îÄ‚îÄ stats.js        ‚Üê —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
  ‚îÇ   ‚îú‚îÄ‚îÄ utils.js        ‚Üê —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (debug, –º–∏–≥—Ä–∞—Ü–∏–∏)
  ‚îÇ   ‚îî‚îÄ‚îÄ webhooks.js     ‚Üê webhook'–∏ –¥–ª—è –ø–ª–∞—Ç–µ–∂–µ–π
  ‚îú‚îÄ‚îÄ services/
  ‚îÇ   ‚îî‚îÄ‚îÄ bonus.service.js ‚Üê –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –±–æ–Ω—É—Å–∞–º–∏
  ‚îú‚îÄ‚îÄ utils/
  ‚îÇ   ‚îú‚îÄ‚îÄ date-helpers.js  ‚Üê —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏
  ‚îÇ   ‚îî‚îÄ‚îÄ string-helpers.js ‚Üê —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏
  ‚îî‚îÄ‚îÄ jobs/
      ‚îî‚îÄ‚îÄ cron-tasks.js    ‚Üê –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
```

---

## üì¶ –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π

### 1. **src/authentication.js** (106 —Å—Ç—Ä–æ–∫)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–æ–ª—å–∫–æ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
- `MyAuthenticationService` - –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `LegacyJWTStrategy` - —Å—Ç—Ä–∞—Ç–µ–≥–∏—è JWT —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Å—Ç–∞—Ä—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤
- `SMSStrategy` - –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ SMS-–∫–æ–¥—É
- `LegacyLocalStrategy` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (—Ç–µ–ª–µ—Ñ–æ–Ω + –ø–∞—Ä–æ–ª—å)

**–£–º–µ–Ω—å—à–µ–Ω–∏–µ:** —Å 1939 –¥–æ 106 —Å—Ç—Ä–æ–∫ (-94.5%)

---

### 2. **src/routes/partner.js**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Å –∑–∞—â–∏—Ç–æ–π API-–∫–ª—é—á–æ–º

**–û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
```javascript
GET  /v1/partner/company         // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–æ–º–ø–∞–Ω–∏–∏
GET  /v1/partner/customer        // –ü–æ–ª—É—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞
GET  /v1/partner/user            // –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
POST /v1/partner/purchase        // –°–æ–∑–¥–∞—Ç—å –ø–æ–∫—É–ø–∫—É
POST /v1/partner/revert          // –û—Ç–º–µ–Ω–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
POST /v1/partner/card            // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—É
GET  /v1/partner/certificate     // –ü–æ–ª—É—á–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
POST /v1/partner/certificates    // –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ (v1)
POST /v2/partner/certificates    // –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏ (v2)
POST /v1/partner/sms             // –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ SMS
POST /v1/partner/birthdays       // –ë–æ–Ω—É—Å—ã –Ω–∞ –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è
POST /v1/partner/accruebonuses   // –ù–∞—á–∏—Å–ª–∏—Ç—å –±–æ–Ω—É—Å—ã
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Middleware `apikeyVerify` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ API-–∫–ª—é—á–∞
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å `BonusService`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ (–±—É–º–∞–∂–Ω—ã—Ö –∏ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö)

---

### 3. **src/routes/stats.js**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
```javascript
GET /bonuses              // –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ–Ω—É—Å–æ–≤
GET /purchase             // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—É–ø–æ–∫
GET /statoperations       // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ –¥–∞—Ç–∞–º
GET /statclients          // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
GET /statcertificates     // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–º–∞–∂–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
GET /statelcerts          // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
GET /ratings              // –†–µ–π—Ç–∏–Ω–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
```

**–§—É–Ω–∫—Ü–∏–∏:**
- `getStats()` - —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤
- `getCategories()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–∞—Ç
- –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ MongoDB –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏

---

### 4. **src/routes/utils.js**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –º–∏–≥—Ä–∞—Ü–∏–π

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
```javascript
GET  /push                   // –¢–µ—Å—Ç push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
GET  /cert                   // –ú–∏–≥—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
GET  /checkoperations        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–µ—Ä–∞—Ü–∏–π
GET  /checkphone             // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
GET  /checkcards             // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—Ä—Ç
GET  /checknames             // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–µ–Ω
GET  /checkbonuses           // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–ª–æ–≤
GET  /birthday               // –ú–∏–≥—Ä–∞—Ü–∏—è –¥–Ω–µ–π —Ä–æ–∂–¥–µ–Ω–∏—è
GET  /checkexpired           // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–µ–∫—à–∏–µ –±–æ–Ω—É—Å—ã
GET  /blockcertificates      // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
GET  /unblockcertificates    // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
```

---

### 5. **src/routes/webhooks.js**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** Webhook'–∏ –¥–ª—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
```javascript
POST /payment         // Webhook –æ—Ç –°–±–µ—Ä–±–∞–Ω–∫–∞
GET  /v1/sendmail     // –¢–µ—Å—Ç–æ–≤–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ email
GET  /v1/sendorder    // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑
GET  /v1/sendcert     // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
GET  /v1/findcert     // –ù–∞–π—Ç–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
GET  /v1/checkorder   // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞
```

---

### 6. **src/services/bonus.service.js**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –±–æ–Ω—É—Å–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π

**–ú–µ—Ç–æ–¥—ã:**
```javascript
getUserOperations(userId)      // –ü–æ–ª—É—á–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
calcScores(userId)             // –ü–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –±–∞–ª–ª—ã
getUserFromToken(code)         // –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ç–æ–∫–µ–Ω—É/–∫–∞—Ä—Ç–µ
getUserFromPhone(phone)        // –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
checkExpired(action)           // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–µ–∫—à–∏–µ –±–æ–Ω—É—Å—ã
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –±–∞–ª–ª–æ–≤ —Å —É—á–µ—Ç–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ MongoDB
- –û—Ç–ø—Ä–∞–≤–∫–∞ SMS-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

---

### 7. **src/utils/date-helpers.js**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏

**–§—É–Ω–∫—Ü–∏–∏:**
```javascript
two(s)                  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –≤–µ–¥—É—â–∏–º –Ω—É–ª–µ–º
addDays(date, days, type)   // –î–æ–±–∞–≤–∏—Ç—å –¥–Ω–∏ –∫ –¥–∞—Ç–µ
startday(date)          // –ù–∞—á–∞–ª–æ –¥–Ω—è
endday(date)            // –ö–æ–Ω–µ—Ü –¥–Ω—è
getLocalDate(d)         // –§–æ—Ä–º–∞—Ç DD.MM.YYYY
toJSONLocal(date)       // –§–æ—Ä–º–∞—Ç DD.MM.YYYY HH:MM:SS
formatDate(d)           // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç—ã
isDate(date)            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –¥–∞—Ç–æ–π
parseDate(str)          // –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç—ã –∏–∑ —Å—Ç—Ä–æ–∫–∏
```

---

### 8. **src/utils/string-helpers.js**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å—Ç—Ä–æ–∫–∞–º–∏

**–§—É–Ω–∫—Ü–∏–∏:**
```javascript
ucFirst(str)  // –ü–µ—Ä–≤–∞—è –±—É–∫–≤–∞ –∑–∞–≥–ª–∞–≤–Ω–∞—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ—á–Ω—ã–µ
```

---

### 9. **src/jobs/cron-tasks.js**
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á

**–ó–∞–¥–∞—á–∏:**
```javascript
// 01:00 - —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ MongoDB
cron.schedule("0 0 1 * * *", ...)

// 23:59 - —Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –±–æ–Ω—É—Å–æ–≤
cron.schedule("0 59 23 * * *", ...)

// 09:00 - SMS –æ –∏—Å—Ç–µ–∫–∞—é—â–∏—Ö –±–æ–Ω—É—Å–∞—Ö
cron.schedule("0 0 9 * * *", ...)
```

---

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ app.js

### –ë—ã–ª–æ:
```javascript
const authentication = require('./authentication')
app.configure(authentication)
// ... –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π cron
```

### –°—Ç–∞–ª–æ:
```javascript
const authentication = require('./authentication')
const partnerRoutes = require('./routes/partner')
const statsRoutes = require('./routes/stats')
const utilsRoutes = require('./routes/utils')
const webhooksRoutes = require('./routes/webhooks')
const cronTasks = require('./jobs/cron-tasks')

app.configure(authentication)
app.configure(partnerRoutes)
app.configure(statsRoutes)
app.configure(utilsRoutes)
app.configure(webhooksRoutes)
app.configure(cronTasks)
```

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

### 1. **–ß–∏—Ç–∞–µ–º–æ—Å—Ç—å**
- ‚úÖ –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –∏–º–µ–µ—Ç —á–µ—Ç–∫—É—é –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
- ‚úÖ –õ–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –Ω—É–∂–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ –≤ 10+ —Ä–∞–∑

### 2. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç –¥—Ä—É–≥–∏–µ
- ‚úÖ –ü—Ä–æ—â–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- ‚úÖ –õ–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –∫–æ–¥

### 3. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**
- ‚úÖ –ú–æ–∂–Ω–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –º–æ–¥—É–ª–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ä–æ—É—Ç–æ–≤
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–Ω–µ—Å—Ç–∏ –º–æ–¥—É–ª–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã

### 4. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**
- ‚úÖ –ö–∞–∂–¥—ã–π –º–æ–¥—É–ª—å –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ
- ‚úÖ Mock'–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–æ—â–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å
- ‚úÖ Unit-—Ç–µ—Å—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω—ã–º–∏

### 5. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**
- ‚úÖ `BonusService` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- ‚úÖ –£—Ç–∏–ª–∏—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ–º –º–æ–¥—É–ª—è–º
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

---

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. **API-–∫–ª—é—á –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```javascript
// TODO: –í—ã–Ω–µ—Å—Ç–∏ –≤ .env
const APIKEY = process.env.PARTNER_API_KEY || "RW9u...";
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å `.env` —Ñ–∞–π–ª:
```env
PARTNER_API_KEY=RW9uRHkzSGxhV3pZT10xaE1fbHBEJnFSMElsM0hwOmN2VnZiZTopVl5bQDg3Jj14Kms=
```

### 2. **–ü—É—Ç–∏ –≤ cron-tasks.js**
```javascript
const backupPath = process.env.BACKUP_PATH || 'e:\\Dropbox\\backups\\';
const mongoPath = process.env.MONGO_PATH || 'c:\\Program Files\\MongoDB\\Server\\3.4\\bin\\mongodump.exe';
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ `.env`

### 3. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
- ‚úÖ –í—Å–µ API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω–µ
- ‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| **authentication.js** | 1939 —Å—Ç—Ä–æ–∫ | 106 —Å—Ç—Ä–æ–∫ | -94.5% |
| **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤** | 1 | 9 | +800% |
| **–°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** | 1939 —Å—Ç—Ä–æ–∫ | 215 —Å—Ç—Ä–æ–∫ | -89% |
| **–ú–æ–¥—É–ª–µ–π** | 0 | 4 —Ä–æ—É—Ç–∞ + 1 —Å–µ—Ä–≤–∏—Å + 2 —É—Ç–∏–ª–∏—Ç—ã + 1 job | +8 |

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:

1. **–°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª:**
```env
NODE_ENV=production
PORT=3030
MONGO_URI=mongodb://admin:password@localhost:27017/fserver
PARTNER_API_KEY=your_api_key_here
JWT_SECRET=your_jwt_secret_here
SMS_API_KEY=your_sms_api_key_here
EMAIL_PASSWORD=your_email_password_here
BACKUP_PATH=/path/to/backups/
MONGO_PATH=/path/to/mongodump
```

2. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã:**
```javascript
// test/services/bonus.service.test.js
describe('BonusService', () => {
  it('should calculate scores correctly', async () => {
    // ...
  });
});
```

3. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å API:**
   - –î–æ–±–∞–≤–∏—Ç—å Swagger/OpenAPI –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–æ–≥–æ API
   - –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

4. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
   - –ó–∞–º–µ–Ω–∏—Ç—å `console.log` –Ω–∞ Winston
   - –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rotation –ª–æ–≥–æ–≤

5. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫

---

## üìù –ú–∏–≥—Ä–∞—Ü–∏—è

–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:

1. **–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–π —Ñ–∞–π–ª:**
```bash
# –°–¥–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π
cp src/authentication.js src/authentication.js.backup
```

2. **–í—Å–µ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã —É–∂–µ —Å–æ–∑–¥–∞–Ω—ã:**
   - `src/authentication.js` (–ø–µ—Ä–µ–ø–∏—Å–∞–Ω)
   - `src/routes/partner.js`
   - `src/routes/stats.js`
   - `src/routes/utils.js`
   - `src/routes/webhooks.js`
   - `src/services/bonus.service.js`
   - `src/utils/date-helpers.js`
   - `src/utils/string-helpers.js`
   - `src/jobs/cron-tasks.js`

3. **app.js —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω** —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π

4. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
```bash
npm start
```

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:**
   - –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (JWT, Local, Mobile)
   - –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ API
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
   - Webhook'–∏
   - Cron-–∑–∞–¥–∞—á–∏

---

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MongoDB –∑–∞–ø—É—â–µ–Ω–∞

---

**–î–∞—Ç–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:** 28 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** 1.0.0

